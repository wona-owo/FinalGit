<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="post">
	
	<!-- 게시글 데이터 조회 -->
	<select id="postData" parameterType="_int"
	resultType="post">
		
		select f.post_file_no as postFileNo,
			   f.post_no as postNo,
			   f.post_file_name as postFileName,
			   p.user_no as userNo,
			   p.post_content as postContent,
			   p.post_date as postDate
	      from post_file f
		 join post p on (f.post_no = p.post_no)	  
		 where p.user_no = ${_parameter} and (substr(f.post_file_name,-6,1) = '1')  		
	</select>
	
	<!-- 게시글 이미지 리스트 조회 -->
	<select id="imgList" parameterType="_int"
	resultType="String">
		
		select f.post_file_name
		 from post_file f
		 join post p on (f.post_no = p.post_no)
	     where p.post_no = ${_parameter}
	</select>
	
	<!-- 게시글 코드(시퀀스) 생성 -->	
	<select id="getPostId" resultType="_int">
		select seq_post.nextval from dual
	</select>
	
	<!-- 게시글 생성 -->
	<insert id="write" parameterType="post">
		insert into post 
		(post_no, user_no, post_content, post_date) 
		values
		(#{postNo}, #{userNo}, #{postContent}, sysdate)
	</insert>
	
	<!-- 이미지 삽입 -->
	<insert id="image" parameterType="post">
		insert into post_file
		(post_file_no, post_no, post_file_name)
		values
		(seq_post_file.nextval, #{postNo}, #{postFileName})
	</insert>
	
	<!-- 해시태그 삽입 -->
	<insert id="hashTag" parameterType="map">	
		insert into hashtag
		(hash_no, post_no, hash_name)
		values
        (seq_hashtag.nextval, #{postNo}, #{tag})  	
	</insert>
	
	<!-- 해시태그 불러오기 -->
	<select id="tagList" parameterType="_int"
	resultType="String">
		select hash_name
		from hashtag h
		join post p on (p.post_no = h.post_no)
		where h.post_no = ${_parameter}		
	</select>
	
	
</mapper>
